---
layout: post
title: Числа Фибоначчи
date: 2022-12-18
categories: ["Swift", "SPL"]
---

Числа Фибоначчи — это ряд, состоящий из целых чисел. Их особенность заключается в том, что каждый элемент представляет собой сумму двух предыдущих чисел.

Последовательность Фибоначчи начинается с 0 и 1. Продолжить ряд легко: 0, 1, 1, 2, 3, 5, 8, 13, 21, 34, 55, 89, 144 и так до бесконечности.

Первые два числа равны 0 и 1, а каждое последующее число равно сумме двух предыдущих чисел.

Последовательность чисел Фибоначчи определяется формулой `F(n) = F(n-1) + F(n-2)`. 

При этом `F(0) = 0`, `F(1) = 1`, `n >= 2`, `n` - целое число.

![Черепица с квадратами, длина сторон которых является последовательными числами Фибоначчи](https://obodev.github.io/assets/images/fibonacci.png)

Иногда числа Фибоначчи рассматривают и для отрицательных значений `n` как двусторонне бесконечную последовательность, удовлетворяющую тому же рекуррентному соотношению. Соответственно, члены с отрицательными индексами легко получить с помощью эквивалентной формулы «назад»: `F(n) = F(n+2) - F(n+1)`.

| n   | F(n) |
|:----|:-----|
| ... | ...  |
| −6  | -8   |
| -5  | 5    |
| -4  | -3   |
| -3  | 2    |
| -2  | -1   |
| -1  | 1    |
| 0   | 0    |
| 1   | 1    |
| 2   | 1    |
| 3   | 2    |
| 4   | 3    |
| 5   | 5    |
| 6   | 8    |
| ... | ...  |

Зависимость между значениями в положительной и отрицательной последовательности: `F(-n) = (-1)^(n+1) * F(n)`.

## Свойства чисел Фибоначчи

Некоторые свойства чисел Фибоначчи

- Наибольший общий делитель двух чисел Фибоначчи равен числу Фибоначчи с индексом, равным наибольшему общему делителю индексов, то есть `(F(m), F(n)) = F(m,n)`;
- Произведение и частное двух любых различных чисел Фибоначчи, отличных от единицы, никогда не является числом Фибоначчи;
- Натуральное число `N` является числом Фибоначчи тогда и только тогда, когда `5 N^(2) + 4` или `5 N^(2) - 4` является квадратом;
- Не существует арифметической прогрессии длиной больше 3, состоящей из чисел Фибоначчи;
- Произведение любых `n` подряд идущих чисел Фибоначчи делится на произведение первых `n` чисел Фибоначчи.

## Несколько идей для вычисления числа Фибоначчи

Есть разные способы нахождения чисел Фибоначчи (формула Бине, матричный способ, рекуррентное вычисление, рекурсивная версия и прочие). Ниже рассмотрено несколько способов.
 
### Рекуррентное вычисление

Пожалуй, самый простой подход к вычислению числа Фибоначчи по его заданному номеру — это вычисление по рекуррентной формуле. Заведём две переменные `a` и `b` для хранения двух соседних чисел Фибоначчи, и присвоим им начальные значения `0` и `1`. Затем в цикле `n` раз сдвинемся по последовательности, заменяя `a` на `b`, а `b` на `a + b`. Здесь важно отметить, что присваивания в цикле следует производить одновременно, так как после присваивания `a = b` в выражении `a + b` окажется новое значение переменной `a`, в то время как там требуется старое. Так что параллельное присваивание — это лучший выбор.

### Рекурсивная версия

Рекуррентная сводит задачу вычисления `F(n)` к задачам вычисления чисел `F(n-1)` и `F(n-2)`. Это соображение приводит к рекурсивному решению, в котором вычислению `F(n)` посвящена отдельная процедура `F` с параметром `n`. Она возвращает `n`, если `n < 2`. В противном случае она дважды рекурсивно вызывает сама себя — с параметрами `n - 1` и `n - 2`, после чего возвращает сумму значений, возвращённых при этих вызовах.

Но, несмотря на изящество и простоту алгоритма, - получаем программу-катастрофу, так как в зависимости от линейного увеличения `n` затраты времени и ресурсов растут нелинейно. Причина в том, что на протяжении вычислений приходится по несколько раз вычислять одно и тоже число Фибоначчи. И чем больше `n`, тем больше растёт количество повторных вычислений.

Для объяснения рассмотрим следующее изображение, в котором показано нахождение числа Фибоначчи для `n = 5`

![Рекурсивная версия нахождения числа Фибоначчи](https://obodev.github.io/assets/images/fibonacci-recursion.png "Рекурсивная версия нахождения числа Фибоначчи")

Теперь, глядя на рисунок, подсчитаем, сколько раз вызывалась рекурсивная процедура для вычисления `F(5)`:

| `F(n)` | Сколько раз вычисляется                                  |
|:-------|:---------------------------------------------------------|
| `F(5)` | 1 раз                                                    |
| `F(4)` | 1 раз (для вычисления `F(5)`)                            |
| `F(3)` | 2 раза (1 раз для вычисления `F(5)` и 1 раз для `F(4)`)  |
| `F(2)` | 3 раза (1 раз для вычисления `F(4)` и 2 раза для `F(3)`) |
| `F(1)` | 5 раз (2 раза для вычисления `F(3)` и 3 раза для `F(2)`) |
| `F(0)` | 2 раза (для вычисления `F(2)`)                           |

Всего для вычисления `F(5)` рекурсивная процедура вызывалась 14 раз, причём для каждого значения параметра в среднем больше двух раз. Это явный перебор, но пока это не производит столь жуткого впечатления. Что же будет при больших `n`?

Можно увидеть, что числа в правой колонке таблицы сами образуют (за исключением последнего) последовательность Фибоначчи. Их сумма и есть нужное число рекурсивных вызовов.

### Рекурсивная версия с мемоизацией

Есть приём программирования, позволяющий улучшить рекурсивную версию. Он устраняет главную проблему, вызванную рекурсией: многократные вызовы рекурсивной процедуры при одних и тех же значениях параметров. Если каждое значение, вычисленное при вызове процедуры, запоминать в таблице вместе со значением параметра, переданного при вызове, то процедура, прежде повторно выполнять то же самое вычисление, могла бы поискать в этой таблице уже готовое решение. Этот приём называется **мемоизацией**.

Например, в нашей задаче ранее найденные числа Фибоначчи можно было бы запоминать в массиве, записывая их в ячейку с соответствующим индексом. Каждый раз при вызове рекурсивная процедура искала бы решение сначала в массиве, и, если поиск увенчался успехом, возвращала бы найденное значение. И только при неудаче приступала к трудоёмким вычислениям (в частности, к рекурсивным вызовам). Получив результат, она запоминала бы его в массиве, и только после этого возвращала.

## История чисел Фибоначчи

Леонардо Пизано, по прозвищу Фибоначчи, — итальянский математик — родился в Пизе в 1170 году. Его отец работал в торговом порту на северо-востоке Алжира и часто путешествовал.

Фибоначчи изучал математику и во время обширных путешествий познакомился с индийско-арабской системой счисления. Оттуда математик и узнал о числовой последовательности, которую в древней Индии использовали в стихосложении.

В одном из своих самых известных трудов под названием «Liber abaci», Леонардо Пизанский приводит уникальную закономерность чисел, которые при постановке в ряд образуют линию цифр, каждая из которых является суммой двух предыдущих чисел. Названа последовательность в честь итальянца, потому что именно он представил ее европейскому обществу.

Математик обратил внимание на числовую последовательность, когда думал о разведении кроликов.

Задача была поставлена следующим образом: «Если новорожденную пару кроликов, самца и самку, поместить в поле, то сколько пар кроликов будет через год?». Но как известно, ни одну практическую задачу невозможно решить без некоторых ограничений и предположений.  Поэтому, к условию задачи добавились следующие допущения:

- Кролики не умирают;
- Кролики достигают половой зрелости за один месяц;
- Срок беременности у кроликов – один месяц;
- Достигнув половой зрелости, кролики-самки рожают ежемесячно кролика-самца и кролика-самку.

Схема разведения кроликов выглядит следующим образом:

![Задача про кроликов](https://obodev.github.io/assets/images/fibonacci-bunny.png "Задача про кроликов")

Так как по условию задачи в поле поместили новорожденных кроликов, то спариваться они не могут, так как не достигли половой зрелости. Через месяц кролики начинают спариваться и еще через один – рождается первая пара потомков. "Родители" продолжают наращивать потомство, а дети месяц ждут своего взросления, чтобы тоже стать родителями. В итоге, через 3 месяца по полю будут бегать три пары кроликов. Через 4 месяца уже 5 пар, а через 5 месяцев – 8.

- В начале первого месяца есть только одна новорождённая пара (1).
- В конце первого месяца по-прежнему только одна пара кроликов, но уже спарившаяся (1).
- В конце второго месяца первая пара рождает новую пару и опять спаривается (2).
- В конце третьего месяца первая пара рождает ещё одну новую пару и спаривается, вторая пара только спаривается (3).
- В конце четвёртого месяца первая пара рождает ещё одну новую пару и спаривается, вторая пара рождает новую пару и спаривается, третья пара только спаривается (5).

В конце n-го месяца количество пар кроликов будет равно количеству пар в предыдущем месяце плюс количеству новорождённых пар, которых будет столько же, сколько пар было два месяца назад.

Уже прослеживается закономерность. В конце каждого месяца количество пар кроликов будет больше, чем в предыдущем месяце ровно на столько, сколько пар было два месяца назад.

## Золотое сечение

С точки зрения математики — это красивая последовательность. Но больший интерес для исследователей представляет не сам ряд, а частное соседних чисел, равное, примерно **1,618** для всех элементов ряда. Эта пропорция больше известна как **золотое сечение**.

Каждое число из ряда Фибоначчи, разделенное на последующее, имеет значение, стремящееся к уникальному показателю, которое составляет 1,618. Первые числа ряда Фибоначчи не дают настолько точное значение, однако по мере нарастания, соотношение постепенно выравнивается и становится все более точным.

Из-за своего повсеместного применения в природе, золотое сечение (именно так число Фибоначчи иногда называют в искусстве и математике) считается одним из самых гармонизирующих законов мироздания, который упорядочивает структуру окружающего нас мира и направляет жизнь на развитие. 

Так, правило золотого сечения применяется природой для образования траекторий движения вихревых потоков в ураганах, при образовании эллиптических галактик, к которым относится и наш Млечный Путь, при «строительстве» раковины улитки или ушной раковины человека, направляет движение косяка рыб и показывает траекторию движения испуганной стаи оленей, врассыпную убегающую от хищника.

!["Золотое сечение" в природе](https://obodev.github.io/assets/images/fibonacci-nature.jpg '"Золотое сечение" в природе')

Это соотношение можно найти во предметах, которые нас отгружают: гармония в гранях снежинок, в расположении лепестков цветов, ячеек ананаса, завитки раковин у улитки — все подчиняется правилу золотого сечения. Даже строение нашего тела гармонично: если измерить наш рост и разделить на расстояние от пояса до ступней или длину руки на расстояние от локтя до кончиков пальцев, получится известное нам соотношение 1,618.

Находя золотое сечение в лице того или иного человека, мы инстинктивно воспринимаем собеседника в качестве гармоничной личности, чье развитие происходит без сбоев и нарушений. Этим можно объяснить то, почему иногда нам по непонятным причинам больше нравится одно лицо, чем другое.

### Что такое спираль Фибоначчи

Золотая спираль или спираль Фибоначчи — это логарифмическая спираль. Ее коэффициент роста равен `φ4`, где `φ` — золотое сечение. Он показывает, во сколько раз изменился полярный радиус спирали при повороте на угол 360 градусов.

![Спираль Фибоначчи](https://obodev.github.io/assets/images/fibonacci-spiral.png "Спираль Фибоначчи")

Эта спираль называется так из-за связи с последовательностью вложенных друг в друга прямоугольников с отношением сторон, равным φ, которые принято называть золотыми. Популярность золотая спираль приобрела из-за того, что известная с начала XVI века и применяющаяся в искусстве спираль, построенная по методу Дюрера, отлично подошла для решения своих задач.

---

## Еще полезные ссылки
